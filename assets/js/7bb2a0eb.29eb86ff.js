"use strict";(self.webpackChunkdocument_sample=self.webpackChunkdocument_sample||[]).push([[9054],{8912:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});var i=s(4848),t=s(8453);const r={id:"staking-indexer",sidebar_label:"Staking Indexer"},a="Staking Indexer",o={id:"user-guides/bitcoin-staking-phase1/backend-deployment/services/staking-indexer",title:"Staking Indexer",description:"The staking indexer is a tool that extracts BTC staking relevant data",source:"@site/docs/user-guides/bitcoin-staking-phase1/backend-deployment/services/staking-indexer.md",sourceDirName:"user-guides/bitcoin-staking-phase1/backend-deployment/services",slug:"/user-guides/bitcoin-staking-phase1/backend-deployment/services/staking-indexer",permalink:"/docs/user-guides/bitcoin-staking-phase1/backend-deployment/services/staking-indexer",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/user-guides/bitcoin-staking-phase1/backend-deployment/services/staking-indexer.md",tags:[],version:"current",frontMatter:{id:"staking-indexer",sidebar_label:"Staking Indexer"},sidebar:"docs",previous:{title:"Bitcoin Staking Backend Services Setup",permalink:"/docs/user-guides/bitcoin-staking-phase1/backend-deployment/services/overview"},next:{title:"Staking API",permalink:"/docs/user-guides/bitcoin-staking-phase1/backend-deployment/services/staking-api"}},d={},c=[{value:"1. Hardware Requirements",id:"1-hardware-requirements",level:2},{value:"2. Install Staking Indexer",id:"2-install-staking-indexer",level:2},{value:"2.1 Clone the repository to your local machine from Github",id:"21-clone-the-repository-to-your-local-machine-from-github",level:3},{value:"2.2 Check out the desired version",id:"22-check-out-the-desired-version",level:3},{value:"2.3 Install the sid daemon binary by running",id:"23-install-the-sid-daemon-binary-by-running",level:3},{value:"3. Configuration",id:"3-configuration",level:2},{value:"3.1 Generate the default configuration",id:"31-generate-the-default-configuration",level:3},{value:"3.2 Update default configurations",id:"32-update-default-configurations",level:3},{value:"4. Download global params",id:"4-download-global-params",level:2},{value:"5. Start Staking Indexer",id:"5-start-staking-indexer",level:2},{value:"6. Create systemd service (Optional - Linux Only)",id:"6-create-systemd-service-optional---linux-only",level:2},{value:"6.1 Create systemd service definition",id:"61-create-systemd-service-definition",level:3},{value:"6.2 Reload systemd manager configuration",id:"62-reload-systemd-manager-configuration",level:3},{value:"6.3 Enable the service to start on boot",id:"63-enable-the-service-to-start-on-boot",level:3},{value:"6.4 Start the service",id:"64-start-the-service",level:3},{value:"6.5 Verify Staking Indexer is running",id:"65-verify-staking-indexer-is-running",level:3},{value:"7. Monitoring",id:"7-monitoring",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"staking-indexer",children:"Staking Indexer"}),"\n",(0,i.jsx)(n.p,{children:"The staking indexer is a tool that extracts BTC staking relevant data\nfrom the Bitcoin blockchain, ensures that it follows the pre-requisites\nfor a valid staking transaction, and determines whether\nthe stake should be active or not."}),"\n",(0,i.jsx)(n.p,{children:"All valid staking transactions are transformed into a structured form,\nstored in a database, and published as events in a RabbitMQ messaging queue\nfor consumption by consumers."}),"\n",(0,i.jsx)(n.p,{children:"The staking indexer is the enforcer of the Bitcoin Staking protocol\nand serves as the ground truth for the lock-only Bitcoin Staking system."}),"\n",(0,i.jsx)(n.h2,{id:"1-hardware-requirements",children:"1. Hardware Requirements"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CPU: Multi-core processor (4 cores minimum)"}),"\n",(0,i.jsx)(n.li,{children:"Memory: Minimum 4GB RAM, recommended 8GB RAM"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"2-install-staking-indexer",children:"2. Install Staking Indexer"}),"\n",(0,i.jsx)(n.h3,{id:"21-clone-the-repository-to-your-local-machine-from-github",children:"2.1 Clone the repository to your local machine from Github"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/babylonlabs-io/staking-indexer.git\n"})}),"\n",(0,i.jsx)(n.h3,{id:"22-check-out-the-desired-version",children:"2.2 Check out the desired version"}),"\n",(0,i.jsxs)(n.p,{children:["You can find the latest release\n",(0,i.jsx)(n.a,{href:"https://github.com/babylonlabs-io/staking-indexer/releases",children:"here"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd staking-indexer\ngit checkout tags/{VERSION}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"23-install-the-sid-daemon-binary-by-running",children:"2.3 Install the sid daemon binary by running"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"make install\n"})}),"\n",(0,i.jsx)(n.h2,{id:"3-configuration",children:"3. Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"31-generate-the-default-configuration",children:"3.1 Generate the default configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sid init\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will create a sid.conf file in the default home directory.\nThe default home directories for different operating systems are:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["MacOS:  ",(0,i.jsx)(n.code,{children:"~/Users/<username>/Library/Application Support/Sid"})]}),"\n",(0,i.jsxs)(n.li,{children:["Linux: ",(0,i.jsx)(n.code,{children:"~/.Sid"})]}),"\n",(0,i.jsxs)(n.li,{children:["Windows: ",(0,i.jsx)(n.code,{children:"C:\\Users\\<username>\\AppData\\Local\\Sid"})]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"32-update-default-configurations",children:"3.2 Update default configurations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Bitcoin network to run on"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Set the ",(0,i.jsx)(n.code,{children:"BitcoinNetwork"})," to match with the information from the\n",(0,i.jsx)(n.a,{href:"/docs/user-guides/bitcoin-staking-phase1/backend-deployment/infra/bitcoind",children:"installed Bitcoin node"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"[Application Options]\n; Bitcoin network to run on\nBitcoinNetwork = signet\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Bitcoin node to connect to"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Set the Bitcoin node connection address (",(0,i.jsx)(n.code,{children:"RPCHost"}),")\nand credentials (",(0,i.jsx)(n.code,{children:"RPCUser"})," and ",(0,i.jsx)(n.code,{children:"RPCUser"}),")\nto match the information from the\n",(0,i.jsx)(n.a,{href:"/docs/user-guides/bitcoin-staking-phase1/backend-deployment/infra/bitcoind",children:"installed Bitcoin node"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"[btcconfig]\n; The daemon's rpc listening address.\nRPCHost = 127.0.0.1:38332\n\n; Username for RPC connections.\nRPCUser = user\n\n; Password for RPC connections.\nRPCPass = pass\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"RabbitMQ cluster to connect to"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Set the RabbitMQ connection address (",(0,i.jsx)(n.code,{children:"Url"}),")\nand credentials (",(0,i.jsx)(n.code,{children:"User"})," and ",(0,i.jsx)(n.code,{children:"Password"}),")\nto match the information from the\n",(0,i.jsx)(n.a,{href:"/docs/user-guides/bitcoin-staking-phase1/backend-deployment/infra/rabbitmq",children:"installed RabbitMQ cluster"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"[queueconfig]\n; the user name of the queue\nUser = user\n\n; the password of the queue\nPassword = password\n\n; the url of the queue\nUrl = localhost:5672\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Prometheus metrics configuration:"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Set the ",(0,i.jsx)(n.code,{children:"Host"})," and ",(0,i.jsx)(n.code,{children:"Port"})," to customize how the metrics are exposed"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"[metricsconfig]\n; IP of the Prometheus server\nHost = 127.0.0.1\n\n; Port of the Prometheus server\nPort = 2112\n"})}),"\n",(0,i.jsx)(n.h2,{id:"4-download-global-params",children:"4. Download global params"}),"\n",(0,i.jsxs)(n.p,{children:["To download the global parameters,\nfollow ",(0,i.jsx)(n.a,{href:"/docs/user-guides/bitcoin-staking-phase1/backend-deployment/global-params#staking-parameters",children:"this"}),"\ninstructions."]}),"\n",(0,i.jsx)(n.h2,{id:"5-start-staking-indexer",children:"5. Start Staking Indexer"}),"\n",(0,i.jsx)(n.p,{children:"In case you are using the default home directory,\nyou can start the staking-indexer running:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sid start\n"})}),"\n",(0,i.jsx)(n.p,{children:"Note: If the indexer fails to start due to re-org,\nplease rerun the command to start it."}),"\n",(0,i.jsx)(n.h2,{id:"6-create-systemd-service-optional---linux-only",children:"6. Create systemd service (Optional - Linux Only)"}),"\n",(0,i.jsx)(n.h3,{id:"61-create-systemd-service-definition",children:"6.1 Create systemd service definition"}),"\n",(0,i.jsxs)(n.p,{children:["Run the following command, replacing ",(0,i.jsx)(n.code,{children:"system_username"}),"\nwith the appropriate system user or service account name:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | sudo tee /etc/systemd/system/sid.service\n[Unit]\nDescription=Sid service\nAfter=network.target\n\n[Service]\nType=simple\nExecStart=$(which sid) start\nRestart=on-failure\nUser=system_username\n\n[Install]\nWantedBy=multi-user.target\nEOF\n"})}),"\n",(0,i.jsx)(n.h3,{id:"62-reload-systemd-manager-configuration",children:"6.2 Reload systemd manager configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,i.jsx)(n.h3,{id:"63-enable-the-service-to-start-on-boot",children:"6.3 Enable the service to start on boot"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable sid.service\n"})}),"\n",(0,i.jsx)(n.h3,{id:"64-start-the-service",children:"6.4 Start the service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start sid.service\n"})}),"\n",(0,i.jsx)(n.h3,{id:"65-verify-staking-indexer-is-running",children:"6.5 Verify Staking Indexer is running"}),"\n",(0,i.jsx)(n.p,{children:"Check sid service status:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl status sid\n"})}),"\n",(0,i.jsx)(n.p,{children:"Expected log:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-accesslog",children:'Jul 04 06:49:54 system_username sid[839944]: 2024-07-04T06:49:55.798273Z        info        Starting Prometheus server        {"address": "127.0.0.1:2114"}\nJul 04 06:49:54 system_username sid[839944]: 2024-07-04T06:49:55.805957Z        info        Starting Staking Indexer App        {"module": "staking indexer"}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"7-monitoring",children:"7. Monitoring"}),"\n",(0,i.jsxs)(n.p,{children:["The service exposes Prometheus metrics through a Prometheus server.\nBy default, the server is reachable under ",(0,i.jsx)(n.code,{children:"127.0.0.1:2112"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var i=s(6540);const t={},r=i.createContext(t);function a(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);