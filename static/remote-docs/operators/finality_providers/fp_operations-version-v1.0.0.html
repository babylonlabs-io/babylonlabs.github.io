
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Remote Documentation</title>
  <style>
    .release-badge {
      background-color: #f0f0f0;
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 4px;
      font-size: 14px;
    }
    article {
      max-width: 800px;
      margin: 0 auto;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }
  </style>
</head>
<body>
  <article>
    <div class="release-badge">Version: <strong>v1.0.0</strong></div>
    <h1>Finality Provider Operation</h1>
<p>This document guides operators through the complete
lifecycle of running a finality provider, including:</p>
<ul>
<li>Installing and configuring the finality provider toolset
(EOTS Manager and Finality Provider daemon)</li>
<li>Managing keys (EOTS key for signatures and Babylon key for rewards)</li>
<li>Registering your finality provider on the Babylon network</li>
<li>Operating and maintaining your finality provider</li>
<li>Collecting rewards</li>
</ul>
<p>This is an operational guide intended for technical finality provider administrators.
For conceptual understanding, see our <a href="./fp-core.md">Technical Documentation</a>.
Please review the <a href="../README.md">high-level explainer</a> before proceeding to
gain an overall understanding of the finality provider.</p>
<h2>Table of Contents</h2>
<ol>
<li><a href="#1-a-note-about-phase-1-finality-providers">A note about Phase-1 Finality Providers</a></li>
<li><a href="#2-system-requirements">System Requirements</a></li>
<li><a href="#3-install-finality-provider-toolset">Install Finality Provider Toolset</a></li>
<li><a href="#4-setting-up-the-eots-daemon">Setting up the EOTS Daemon</a>
<ol>
<li><a href="#41-initialize-the-eots-daemon">Initialize the EOTS Daemon</a></li>
<li><a href="#42-add-an-eots-key">Add an EOTS Key</a>
<ol>
<li><a href="#421-create-an-eots-key">Create an EOTS key</a></li>
<li><a href="#422-import-an-existing-eots-key">Import an existing EOTS key</a></li>
</ol>
</li>
<li><a href="#43-starting-the-eots-daemon">Starting the EOTS Daemon</a></li>
</ol>
</li>
<li><a href="#5-setting-up-the-finality-provider">Setting up the Finality Provider</a>
<ol>
<li><a href="#51-initialize-the-finality-provider-daemon">Initialize the Finality Provider Daemon</a></li>
<li><a href="#52-add-key-for-the-babylon-account">Add key for the Babylon account</a></li>
<li><a href="#53-configure-your-finality-provider">Configure Your Finality Provider</a></li>
<li><a href="#54-starting-the-finality-provider-daemon">Starting the Finality Provider Daemon</a></li>
</ol>
</li>
<li><a href="#6-finality-provider-operations">Finality Provider Operation</a>
<ol>
<li><a href="#61-create-finality-provider">Create Finality Provider</a></li>
<li><a href="#62-statuses-of-finality-provider">Statuses of Finality Provider</a></li>
<li><a href="#63-editing-your-finality-provider">Editing your finality provider</a></li>
<li><a href="#64-jailing-and-unjailing">Jailing and Unjailing</a></li>
<li><a href="#65-slashing-and-anti-slashing">Slashing</a></li>
<li><a href="#66-prometheus-metrics">Prometheus Metrics</a></li>
<li><a href="#67-rewards">Rewards</a>
<ol>
<li><a href="#671-querying-rewards">Querying Rewards</a></li>
</ol>
</li>
</ol>
</li>
<li><a href="#7-recovery-and-backup">Recovery and backup</a>
<ol>
<li><a href="#71-critical-assets">Critical assets</a></li>
<li><a href="#72-backup-recommendations">Backup recommendations</a></li>
<li><a href="#73-recover-finality-provider-db">Recover finality-provider db</a>
<ol>
<li><a href="#731-recover-local-status-of-a-finality-provider">Recover local status of a finality provider</a></li>
<li><a href="#732-recover-public-randomness-proof">Recover public randomness proof</a></li>
</ol>
</li>
</ol>
</li>
</ol>
<h2>1. A note about Phase-1 Finality Providers</h2>
<p>Thank you for participating in the first phase of the Babylon launch. This guide
provides instructions for setting up the full finality provider toolset required
for your participation in the second phase of the Babylon launch.</p>
<p>Finality providers that received delegations on the first phase of the launch
are required to transition their finality providers to the second phase
using the same EOTS key that they used and registered with during Phase-1.
The usage of a different key corresponds to setting up an entirely
different finality provider which will not inherit the Phase-1 delegations.
Not transitioning your Phase-1 finality provider prevents your Phase-1 delegations
from transitioning to the second phase.</p>
<p>If you already have set up a key during Phase-1, please proceed to
<a href="#42-add-an-eots-key">Adding Keys</a> to import your Phase-1 key.</p>
<h2>2. System Requirements</h2>
<p>Recommended specifications for running a Babylon Finality Provider:</p>
<ul>
<li>CPU: 2 vCPUs</li>
<li>RAM: 4GB</li>
<li>Storage: 50GB SSD/NVMe</li>
<li>Network: Stable internet connection</li>
<li>Security:
<ul>
<li>Encrypted storage for keys and sensitive data</li>
<li>Regular system backups</li>
</ul>
</li>
</ul>
<p>These are the minimum specifications for running a finality provider.
Requirements may vary based on network activity and your operational needs.
For production environments, you may want to consider using more robust hardware.</p>
<p><strong>Recovery and Backup</strong>
At the time of writing, the following assets <strong>must not</strong> be lost and should be
backed up frequently. Loss will lead to inability to submit transactions to the
Babylon chain, which will in turn lead to FP jailing and halt BTC Staking reward
accumulation.</p>
<ul>
<li>The <code>keyring-xx</code> folder contains your Babylon keyring, used to submit public
randomness and finality signatures to Babylon.</li>
<li>The <code>finality-provider.db</code> contains essential operational data
including finality signatures, public randomness proofs, and state information.
Loss will prevent voting until recovered.</li>
</ul>
<p>The ability to recreate the <code>finality-provider.db</code> will be offered in the next
few months.</p>
<h2>3. Install Finality Provider Toolset</h2>
<p>The finality provider toolset requires <a href="https://go.dev/dl">Golang 1.23</a>
to be installed.
Please follow the installation instructions <a href="https://go.dev/dl">here</a>.
You can verify the installation with the following command:</p>
<pre><code class="language-shell">go version
</code></pre>
<h3>3.1. Clone the Finality Provider Repository</h3>
<p>Subsequently, clone the finality provider
<a href="https://github.com/babylonlabs-io/finality-provider">repository</a> and checkout
to <code>v0.14.4</code>.</p>
<pre><code class="language-shell">git clone https://github.com/babylonlabs-io/finality-provider.git
cd finality-provider
git checkout v0.14.4
</code></pre>
<h3>3.2. Install Finality Provider Toolset Binaries</h3>
<p>Run the following command to build the binaries and
install them to your <code>$GOPATH/bin</code> directory:</p>
<pre><code class="language-shell">make install
</code></pre>
<p>This command will:</p>
<ul>
<li>Build and compile all Go packages</li>
<li>Install binaries to <code>$GOPATH/bin</code>:
<ul>
<li><code>eotsd</code>: EOTS manager daemon</li>
<li><code>fpd</code>: Finality provider daemon</li>
</ul>
</li>
<li>Make commands globally accessible from your terminal</li>
</ul>
<h3>3.3. Verify Installation</h3>
<p>Run the following command to verify the installation:</p>
<pre><code class="language-shell">fpd version
Version:       0.14.4
Git Commit:    c8c41f0
Git Timestamp: 2025-01-27T14:17:02Z
</code></pre>
<p>If your shell cannot find the installed binaries, make sure <code>$GOPATH/bin</code> is in
the <code>$PATH</code> of your shell. Use the following command to add it to your profile
depending on your shell.</p>
<pre><code class="language-shell">echo 'export PATH=$HOME/go/bin:$PATH' >> ~/.profile
</code></pre>
<h2>4. Setting up the EOTS Daemon</h2>
<p>The EOTS manager daemon is a core component of the finality provider
stack responsible for managing your EOTS keys and producing EOTS signatures
to be used for votes. In this section, we are going to go through
its setup and key generation process.</p>
<h3>4.1. Initialize the EOTS Daemon</h3>
<p>If you haven't already, initialize a home directory for the EOTS Manager
with the following command:</p>
<pre><code class="language-shell">eotsd init --home &#x3C;path>
</code></pre>
<p>If <code>eotsd.conf</code> already exists <code>init</code> will not succeed, if the operator wishes to
overwrite the config file they need to use <code>--force</code>.</p>
<p>Parameters:</p>
<ul>
<li><code>--home</code>: Directory for EOTS Manager configuration and data
<ul>
<li>Default: <code>DefaultEOTSDir</code> the default EOTS home directory:
<ul>
<li><code>C:\Users\&#x3C;username>\AppData\Local\ on Windows</code></li>
<li><code>~/.eotsd</code> on Linux</li>
<li><code>~/Library/Application Support/Eotsd</code> on MacOS</li>
</ul>
</li>
<li>Example: <code>--home ./eotsHome</code></li>
</ul>
</li>
</ul>
<p><strong>Home directory structure:</strong></p>
<pre><code class="language-shell">~/.eotsd/
├── config/
│   └── eotsd.conf      # Configuration file for the EOTS manager
├── data/
│   └── eotsd.db        # Database containing EOTS keys and mappings
├── keyring-*/          # Directory containing EOTS keyring data
└── logs/
    └── eotsd.log       # Log file for the EOTS manager daemon
</code></pre>
<ul>
<li>
<p><strong>eotsd.conf</strong>
This configuration file controls the core settings of the EOTS daemon.
It uses the Cosmos SDK keyring system to securely store and manage EOTS keys.
The file configures how the daemon interacts with its database, manages keys
through the keyring backend, and exposes its RPC interface. Essential
settings include database paths, keyring backend selection (test/file/os),
RPC listener address, logging levels, and metrics configuration.</p>
</li>
<li>
<p><strong>eotsd.db</strong>:</p>
<ul>
<li>EOTS key to key name mappings</li>
<li>BIP340 public key data</li>
<li>Key metadata</li>
</ul>
</li>
<li>
<p><strong>keyring-directory</strong>*:</p>
<ul>
<li>EOTS private keys are securely stored using Cosmos SDK's keyring system</li>
<li>Test backend is used for daemon access (required for automated signing)</li>
<li>Keys are used for EOTS signatures</li>
<li>Other keyring backends (file/os) are supported but not recommended
for daemon use</li>
</ul>
</li>
<li>
<p><strong>eotsd.log</strong>:</p>
<ul>
<li>Key creation and import events</li>
<li>Signature generation requests</li>
<li>Error messages and debugging information</li>
<li>Service status updates</li>
</ul>
</li>
</ul>
<h3>4.2. Add an EOTS Key</h3>
<p>This section explains the process of setting up the private keys for the
EOTS manager. Operators <em>must</em> create an EOTS key before starting the
EOTS daemon.</p>
<p>We will be using the <a href="https://docs.cosmos.network/v0.50/user/run-node/keyring">Cosmos SDK</a>
backends for key storage.</p>
<p>Since this key is accessed by an automated daemon process, it must be stored
unencrypted on disk and associated with the <code>test</code> keyring backend.
This ensures that we can access the eots keys when requested to promptly submit
transactions, such as block votes and public randomness submissions that are
essential for its liveness and earning of rewards.</p>
<p>If you already have an existing key from Phase-1, proceed to
<a href="#422-import-an-existing-eots-key">Import an existing EOTS key</a></p>
<h4>4.2.1. Create an EOTS key</h4>
<p>If you have not created an EOTS key,
use the following command to create a new one:</p>
<pre><code class="language-shell">eotsd keys add &#x3C;key-name> --home &#x3C;path> --keyring-backend test
</code></pre>
<p>Parameters:</p>
<ul>
<li><code>&#x3C;key-name></code>: Name for your EOTS key (e.g., "eots-key-1"). We do not allow
the same <code>keyname</code> for an existing keyname.</li>
<li><code>--home</code>: Path to your EOTS daemon home directory (e.g., "~/.eotsHome")</li>
<li><code>--keyring-backend</code>: Type of keyring storage (<code>test</code>)</li>
</ul>
<p>The command will return a JSON response containing your EOTS key details:</p>
<pre><code>{
    "name": "eots",
    "pub_key_hex":
    "e1e72d270b90b24f395e76b417218430a75683bd07cf98b91cf9219d1c777c19",
    "mnemonic": "parade hybrid century project toss gun undo ocean exercise
      figure decorate basket peace raw spot gap dose daring patch ski purchase
      prefer can pair"
}
</code></pre>
<blockquote>
<p><strong>🔒 Security Tip</strong>: The mnemonic phrase must be stored securely and kept private.
It is the only way to recover your EOTS key if you lose access to it and
if lost it can be used by third parties to get access to your key.</p>
</blockquote>
<h4>4.2.2. Import an existing EOTS key</h4>
<blockquote>
<p>⚡ This section is for Finality Providers who already possess an EOTS key.
If you don't have keys or want to create new ones, you can skip this section.</p>
</blockquote>
<p>There are 3 supported methods of loading your existing EOTS keys:</p>
<ol>
<li>using a mnemonic phrase</li>
<li>importing the <code>.asc</code> file</li>
<li>importing a backed up home directory</li>
</ol>
<p>We have outlined each of these three paths for you below.</p>
<h4>Option 1: Using your mnemonic phrase</h4>
<p>If you are using your mnemonic seed phrase, use the following command to import
your key:</p>
<pre><code class="language-shell">eotsd keys add &#x3C;key-name> --home &#x3C;path> --recover --keyring-backend test
</code></pre>
<p>You'll be prompted to enter:</p>
<ol>
<li>Your BIP39 mnemonic phrase (24 words)</li>
<li>HD path (optional - press Enter to use the default)</li>
</ol>
<blockquote>
<p>⚡ The HD path is optional. If you used the default path when creating your key,
you can skip this by pressing <code>Enter</code> , which by default uses your original private
key.</p>
</blockquote>
<h4>Option 2: Using your <code>.asc</code> file</h4>
<p>If you exported your key to a <code>.asc</code> file. The <code>.asc</code> file should be in the
following format:</p>
<pre><code class="language-shell">-----BEGIN TENDERMINT PRIVATE KEY-----
salt: 35ED0BBC00376EC7FC696838F34A7C36
type: secp256k1
kdf: argon2

8VOGhpuaZhTPZrKHysx24OhaxuBhVnKqb3WcTwJY+jvfNv/EJRoqmrHZfCnNgd13
VP88GFE=
=D87O
-----END TENDERMINT PRIVATE KEY-----
</code></pre>
<p>To load the key, use the following command:</p>
<pre><code class="language-shell">eotsd keys import &#x3C;name> &#x3C;path-to-key> --home &#x3C;path> --keyring-backend test
</code></pre>
<h4>Option 3: Using a File System Backup</h4>
<p>If you backed up your entire EOTS home directory,
you can load it manually to the machine you intend to operate
the EOTS daemon on and specify its location as the <code>--home</code> argument.</p>
<h4>Verify the Key Import</h4>
<p>After importing, you can verify that your EOTS key was successfully loaded:</p>
<pre><code class="language-shell">eotsd keys list &#x3C;key-name> --home &#x3C;path> --keyring-backend test
</code></pre>
<p>Parameters:</p>
<ul>
<li><code>&#x3C;key-name></code>: Name of the EOTS key to verify</li>
<li><code>--keyring-backend</code>: Type of keyring backend to use (<code>test</code>)</li>
<li><code>--home</code>: Directory containing EOTS Manager configuration and data</li>
</ul>
<p>You should see your EOTS key listed with the correct details, confirming that
it has been imported correctly.</p>
<blockquote>
<p>⚠️ <strong>Important</strong>:
If you are a finality provider transitioning your stack from Phase-1,
make sure that you are using the same EOTS key that you
registered in Phase-1.</p>
</blockquote>
<h3>4.3. Starting the EOTS Daemon</h3>
<p>To start the EOTS daemon, use the following command:</p>
<pre><code class="language-shell">eotsd start --home &#x3C;path>
</code></pre>
<p>This command starts the EOTS RPC server at the address specified in <code>eotsd.conf</code>
under the <code>RPCListener</code> field (default: <code>127.0.0.1:12582</code>). You can override
this value by specifying a custom address with the <code>--rpc-listener</code> flag.</p>
<pre><code class="language-shell">2024-10-30T12:42:29.393259Z     info  Metrics server is starting
{"addr": "127.0.0.1:2113"}
2024-10-30T12:42:29.393278Z     info  RPC server listening{"address": "127.0.0.1:12582"}
2024-10-30T12:42:29.393363Z     info  EOTS Manager Daemon is fully active!
EOTS Manager Daemon is fully active!
</code></pre>
<blockquote>
<p><strong>🔒 Security Tip</strong>:</p>
<ul>
<li><code>eotsd</code> holds your private keys which are used for signing</li>
<li>operate the daemon in a separate machine or network segment
>   with enhanced security</li>
<li>only allow access to the RPC server specified by the <code>RPCListener</code>
>   port to trusted sources. You can edit the <code>EOTSManagerAddress</code> in
>   the configuration file of the finality provider to
>   reference the address of the machine where <code>eotsd</code> is running</li>
</ul>
</blockquote>
<h2>5. Setting up the Finality Provider</h2>
<h3>5.1. Initialize the Finality Provider Daemon</h3>
<p>To initialize the finality provider daemon home directory,
use the following command:</p>
<pre><code class="language-shell">fpd init --home &#x3C;path>
</code></pre>
<p>If <code>fpd.conf</code> already exists <code>init</code> will not succeed, if the operator wishes to
overwrite the config file they need to use <code>--force</code>.</p>
<blockquote>
<p>⚡ Running this command with <code>--force</code> will overwrite the existing config file.
Please ensure you have a backup of the existing config file before running
this command.</p>
</blockquote>
<p><strong>Home directory structure:</strong></p>
<ul>
<li>
<p><strong>fpd.conf</strong>: The main configuration file that defines:</p>
<ul>
<li>Network settings (chain-id, node endpoints)</li>
<li>EOTS manager connection settings</li>
<li>Database configuration</li>
<li>Logging settings</li>
<li>RPC listener settings</li>
<li>Metrics configuration</li>
</ul>
</li>
<li>
<p><strong>finality-provider.db</strong>: A LevelDB database that stores:</p>
<ul>
<li>Finality provider registration data</li>
<li>Finality signatures</li>
<li>Public randomness proofs</li>
<li>Last voted block height</li>
</ul>
</li>
<li>
<p><strong>keyring-</strong>* directory: Contains the keyring data where:</p>
<ul>
<li>Babylon account private keys are stored</li>
<li>Test backend is used for daemon access</li>
<li>Keys are used for transaction signing</li>
</ul>
</li>
<li>
<p><strong>fpd.log</strong>: Contains detailed logs including:</p>
<ul>
<li>Block monitoring events</li>
<li>Signature submissions</li>
<li>Error messages and debugging information</li>
<li>Service status updates</li>
</ul>
</li>
</ul>
<pre><code class="language-shell">~/.fpd/
├── config/
│   └── fpd.conf       # Configuration file for the finality provider
├── data/
│   └── finality-provider.db         # Database containing finality provider data
├── keyring-*/         # Directory containing Babylon account keys
└── logs/
    └── fpd.log        # Log file for the finality provider daemon
</code></pre>
<h3>5.2. Add key for the Babylon account</h3>
<p>Each finality provider maintains a Babylon keyring containing
an account used to receive BTC Staking reward commissions and pay fees for
transactions necessary for the finality provider's operation.</p>
<p>Since this key is accessed by an automated daemon process, it must be stored
unencrypted on disk and associated with the <code>test</code> keyring backend.
This ensures that the finality provider daemon can promptly submit
transactions, such as block votes and public randomness submissions that are
essential for its liveness and earning of rewards.</p>
<p>For the <code>fpd</code> keyring, the <code>test</code> backend will be exclusively used, and it is
mandatory that you follow this practice until automated key management becomes
available. Additionally, we are also exploring options to support different
withdrawal addresses, so that rewards can go to a separate address.</p>
<p>It is also important to note that the finality provider daemon will refund
fees for the submission of valid votes as those are essential for the protocol.
All other transactions, will require gas, but will be happening infrequently
or only once. As this keyring is used for both earning and
operational purposes, we strongly recommend maintaining only the necessary
funds for operations in the keyring, and extracting the rest into
more secure locations.</p>
<blockquote>
<p>⚠️ <strong>Important</strong>:
To operate your Finality Provider, ensure your Babylon account is funded.
Block vote transactions have their gas fees refunded, but public randomness
submissions require gas payments. For testnet, you can obtain funds from our
testnet faucet.</p>
</blockquote>
<p>Use the following command to add the Babylon key for your finality provider:</p>
<pre><code class="language-shell">fpd keys add &#x3C;key-name> --keyring-backend test --home &#x3C;path>
</code></pre>
<p>The above <code>keys add</code> command will create a new key pair and store it in your keyring.
The output should look similar to the one below:</p>
<pre><code class="language-json">{
  "address": "bbn19gulf0a4yz87twpjl8cxnerc2wr2xqm9fsygn9",
  "name": "finality-provider",
  "pubkey": {
    "@type": "/cosmos.crypto.secp256k1.PubKey",
    "key": "AhZAL00gKplLQKpLMiXPBqaKCoiessoewOaEATKd4Rcy"
  },
  "type": "local"
}
</code></pre>
<h3>5.3. Configure Your Finality Provider</h3>
<p>Once the finality provider is initialised and its keys are added/created,
the <code>fpd.conf</code> file located in the daemon's home directory must be configured
with the below minimal parameters.</p>
<p>The configuration controls how the finality provider communicates with the
EOTS manager, the Babylon Genesis chain, and manages the keyring and RPC interfaces.</p>
<p>The following is an example of the <code>fpd.conf</code> file:</p>
<pre><code class="language-shell">[Application Options]
EOTSManagerAddress = 127.0.0.1:12582
RPCListener = 127.0.0.1:12581

; The number of Schnorr public randomness for each commitment
NumPubRand              = 50000     # the number of randomness entries generated and committed per batch (~5 days)

; The delay, measured in blocks, between a randomness commit submission and the randomness is BTC-timestamped
TimestampingDelayBlocks = 18000     # delay before timestamping (300 BTC blocks = 18000 Babylon blocks)

[babylon]
Key = &#x3C;finality-provider-key-name-signer> # the key you used above
ChainID = bbn-test-5 # chain ID of the Babylon chain
RPCAddr = http://127.0.0.1:26657 # Your Babylon node's RPC endpoint
KeyDirectory = &#x3C;path> # The `--home` path to the directory where the keyring is stored
</code></pre>
<blockquote>
<p>⚠️ <strong>Critical Public Randomness Configuration</strong>:
The finality provider can only vote for blocks for which it has submitted
public randomness for. Further, for the randomness to be available for use,
it should have been committed in a Babylon Genesis block that has been
confirmed with sufficient depth on the Bitcoin network.</p>
<p>The configuration enables operators to choose how much randomness they commit
each time and what estimations they should perform to target their
randomness activating at a desired height.</p>
<ul>
<li><code>NumPubRand</code> determines the number of public randomness entries
generated and committed per batch. The default value is set to <code>50,000</code>, which is
approx. 5 days of operation with 10 second intervals (the current target
block time for the testnet and mainnet).
<ul>
<li>The codebase enforces a minimum of 1800 of <code>NumPubRand</code> and a maximum of
<code>500000</code>.</li>
<li>An increased value leads to less frequent commits and less gas usage,
but it leads to longer computation times whenever a commit should be
created.</li>
</ul>
</li>
<li><code>TimestampingDelayBlocks</code> defines an estimation
of the number of Babylon Genesis blocks that will be generated
until a public randomness commit is Bitcoin timestamped.
The default value is set to <code>18,000</code> Babylon Genesis blocks,
which corresponds to 300 Bitcoin blocks being generated (the finalization
target for mainnet) and Babylon Genesis having a 10s block time (the target
block time for testnet and mainnet).
<ul>
<li><em>Note: This value should be selected according to the network you
connect to and its parameters. For example, for testnet, with the
finalization target being set to 100 Bitcoin blocks, a value of 6,000 is
more appropriate</em></li>
</ul>
</li>
</ul>
<p>For further explanation of how public randomness works and how it is
committed, refer to the <a href="commit-pub-rand.md">Public Randomness Commit Specification</a>.</p>
</blockquote>
<blockquote>
<p>⚠️ <strong>Important</strong>: Operating a finality provider requires a connection to a
Babylon blockchain node. It is <strong>highly recommended</strong> to operate your own
Babylon full node instead of relying on third parties. You can find
instructions on setting up a Babylon node
<a href="https://github.com/babylonlabs-io/networks/tree/main/bbn-test-5/babylon-node/README.md">here</a>.</p>
</blockquote>
<blockquote>
<p>⚠️ <strong>Critical RPC Configuration</strong>:
When configuring your finality provider to a Babylon RPC node, you should
connect to a <strong>single</strong> node directly. Additionally you <strong>must</strong>
ensure that this node has transaction indexing enabled (<code>indexer = "kv"</code>).
Using multiple RPC nodes or load balancers can lead to sync issues.</p>
</blockquote>
<p>Configuration parameters explained:</p>
<ul>
<li><code>EOTSManagerAddress</code>: Address where your EOTS daemon is running</li>
<li><code>RPCListener</code>: Address for the finality provider RPC server</li>
<li><code>Key</code>: Your Babylon key name from Step 2</li>
<li><code>ChainID</code>: The Babylon network chain ID</li>
<li><code>RPCAddr</code>: Your Babylon node's RPC endpoint</li>
<li><code>KeyDirectory</code>: Path to your keyring directory (same as <code>--home</code> path)</li>
</ul>
<p>Please verify the <code>chain-id</code> and other network parameters from the official
<a href="https://github.com/babylonlabs-io/networks/tree/main/bbn-test-5/">Babylon Networks
repository</a>.</p>
<h3>5.4. Starting the Finality Provider Daemon</h3>
<p>The finality provider daemon (FPD) needs to be running before proceeding with
registration or voting participation.</p>
<p>Start the daemon with:</p>
<pre><code class="language-shell">fpd start --home &#x3C;path>
</code></pre>
<p>An example of the <code>--home</code> flag is <code>--home ./fpHome</code>.</p>
<p>The command flags:</p>
<ul>
<li><code>start</code>: Runs the FPD daemon</li>
<li><code>--home</code>: Specifies the directory for daemon data and configuration</li>
<li><code>--eots-pk</code>: The finality provider instance that will be started identified
by the EOTS public key.</li>
</ul>
<p>It will start the finality provider daemon listening for registration and other
operations. If there is already a finality provider created (described in a
later <a href="#51-initialize-the-finality-provider-daemon">section</a>, <code>fpd start</code> will also start
the finality provider. If there are multiple finality providers created,
<code>--eots-pk</code> is required.</p>
<p>The daemon will establish a connection with the Babylon node and
boot up its RPC server for executing CLI requests.</p>
<p>You should see logs indicating successful startup:</p>
<pre><code class="language-shell">[INFO] Starting finality provider daemon...
[INFO] RPC server listening on...
</code></pre>
<blockquote>
<p>⚠️ <strong>Important</strong>: The daemon needs to run continuously. It's recommended to set
up a system service (like <code>systemd</code> on Linux or <code>launchd</code> on macOS) to manage
the daemon process, handle automatic restarts, and collect logs.</p>
</blockquote>
<p>The above will start the Finality provider RPC server at the address specified
in <code>fpd.conf</code> under the <code>RPCListener</code> field, which has a default value
of <code>127.0.0.1:12581</code>. You can change this value in the configuration file or
override this value and specify a custom address using
the <code>--rpc-listener</code> flag.</p>
<p>All the available CLI options can be viewed using the <code>--help</code> flag. These
options can also be set in the configuration file.</p>
<h3>5.5. Interaction with the EOTS Manager</h3>
<p>There are two pieces to a finality provider entity: the EOTS manager and the
finality provider instance. These components work together and are managed by
separate daemons (<code>eotsd</code> and <code>fpd</code>).</p>
<p>The EOTS manager is responsible for managing the keys for finality providers and
handles operations such as key management, signature generation, and randomness
commitments. Whereas the finality provider is responsible for creating and
registering finality providers and handling the monitoring of the Babylon chain.
The finality provider daemon is also responsible for coordinating various
operations.</p>
<p>The interactions between the EOTS Manager and the finality provider happen
through RPC calls. These calls handle key operations, signature generation,
and randomness commitments. An easy way to think about it is the EOTS Manager
maintains the keys while the FP daemon coordinates any interactions with the
Babylon chain.</p>
<p>The EOTS Manager is designed to handle multiple finality provider keys, operating
as a centralized key management system. When starting a finality provider instance,
you specify which EOTS key to use through the <code>--eots-pk</code> flag. This allows you
to run different finality provider instances using different keys from the same
EOTS Manager. Note that someone having access to your EOTS Manager
RPC will have access to all the EOTS keys held within it.</p>
<p>For example, after registering a finality provider, you can start its daemon by
providing the EOTS public key <code>fpd start --eots-pk &#x3C;hex-string-of-eots-public-key></code>.
Note that a single finality provider daemon can only run with a single
finality provider instance at a time.</p>
<h2>6. Finality Provider Operations</h2>
<h3>6.1 Create Finality Provider</h3>
<p>The <code>create-finality-provider</code> command initializes a new finality provider,
submits <code>MsgCreateFinalityProvider</code> to register it on the Babylon chain, and
saves the finality provider information in the database.</p>
<pre><code class="language-shell">fpd create-finality-provider \
  --chain-id bbn-test-5 \
  --eots-pk &#x3C;eots-pk-hex> \
  --commission-rate 0.05 \
  --key-name finality-provider \
  --moniker "MyFinalityProvider" \
  --website "https://myfinalityprovider.com" \
  --security-contact "security@myfinalityprovider.com" \
  --details "finality provider for the Babylon network" \
  --home ./fpHome
</code></pre>
<p>Required parameters:</p>
<ul>
<li><code>--chain-id</code>: The Babylon chain ID (e.g., for the testnet, <code>bbn-test-5</code>)</li>
<li><code>--eots-pk</code>: The EOTS public key maintained by the connected EOTS manager
instance that the finality provider should use. If one is not provided the
finality provider will request the creation of a new one from the connected
EOTS manager instance.</li>
<li><code>--commission</code>: The commission rate (between 0 and 1) that you'll receive from
delegators</li>
<li><code>--key-name</code>: The key name in your Babylon keyring that your finality
provider will be associated with</li>
<li><code>--moniker</code>: A human-readable name for your finality provider</li>
<li><code>--home</code>: Path to your finality provider daemon home directory</li>
</ul>
<blockquote>
<p>⚠️ <strong>Important</strong>: The same EOTS key should not be used by different
finality providers. This could lead to slashing.</p>
</blockquote>
<blockquote>
<p>We also highly recommend to finality providers to keep the same commission as
with phase-1</p>
</blockquote>
<p>Optional parameters:</p>
<ul>
<li><code>--website</code>: Your finality provider's website</li>
<li><code>--security-contact</code>: Contact email for security issues</li>
<li><code>--details</code>: Additional description of your finality provider</li>
<li><code>--daemon-address</code>: RPC address of the finality provider daemon
(default: <code>127.0.0.1:12581</code>)</li>
</ul>
<p>Alternatively, you can create a finality provider by providing a JSON file
with the finality provider details, similar to the following:</p>
<pre><code class="language-json">{
  "keyName": "The unique key name of the finality provider's Babylon account",
  "chainID": "The identifier of the consumer chain",
  "passphrase": "The pass phrase used to encrypt the keys",
  "commissionRate": "The commission rate for the finality provider, e.g., 0.05",
  "moniker": "A human-readable name for the finality provider",
  "identity": "A optional identity signature",
  "website": "Validator's (optional) website",
  "securityContract": "Validator's (optional) security contact email",
  "details": "Validator's (optional) details",
  "eotsPK": "The hex string of the finality provider's EOTS public key"
}
</code></pre>
<p>To create a finality provider using the JSON file, you can use the following command:</p>
<pre><code class="language-shell">fpd create-finality-provider --json-file &#x3C;path-to-json-file>
</code></pre>
<p>Upon successful creation, the command will return a JSON response containing
your finality provider's details:</p>
<pre><code class="language-json">{
    "finality_provider":
    {
      "fp_addr": "bbn1ht2nxa6hlyl89m8xpdde9xsj40n0sxd2f9shsq",
      "eots_pk_hex":
      "cf0f03b9ee2d4a0f27240e2d8b8c8ef609e24358b2eb3cfd89ae4e4f472e1a41",
      "description":
      {
        "moniker": "MyFinalityProvider",
        "website": "https://myfinalityprovider.com",
        "security_contact": "security@myfinalityprovider.com",
        "details": "finality provider for the Babylon network"
      },
      "commission": "0.050000000000000000",
      "status": "REGISTERED"
    }
    "tx_hash": "C08377CF289DF0DC5FA462E6409ADCB65A3492C22A112C58EA449F4DC544A3B1"
}
Your finality provider is successfully created. Please restart your fpd.
</code></pre>
<p>The response includes:</p>
<ul>
<li><code>fp_addr</code>: Your Babylon account address of the finality provider</li>
<li><code>eots_pk_hex</code>: Your unique EOTS public key identifier</li>
<li><code>description</code>: Your finality provider's metadata</li>
<li><code>commission</code>: Your set commission rate</li>
<li><code>status</code>: Current status of the finality provider.</li>
<li><code>tx_hash</code>: Babylon transaction hash of the finality provider creation
transaction, which you can use to verify the success of the transaction
on the Babylon chain.</li>
</ul>
<h3>6.2. Statuses of Finality Provider</h3>
<p>Once the finality provider has been created, it will have the <code>REGISTERED</code> status.</p>
<p>Below you can see a list of the statuses that a finality provider can transition
to:</p>
<ul>
<li><code>REGISTERED</code>: defines a finality provider that has been created and registered
to the consumer chain but has no delegated stake</li>
<li><code>ACTIVE</code>: defines a finality provider that is delegated to vote</li>
<li><code>INACTIVE</code>: defines a finality provider whose delegations are reduced to
zero but not slashed</li>
<li><code>JAILED</code>: defines a finality provider that has been jailed</li>
<li><code>SLASHED</code>: Defines a finality provider that has been permanently removed from
the network for double signing (signing conflicting blocks at the same height).
This state is irreversible.</li>
</ul>
<p>To check the status of a finality provider, you can use the following command:</p>
<pre><code class="language-shell">fpd finality-provider-info &#x3C;hex-string-of-eots-public-key>
</code></pre>
<p>This will return the same response as the <code>create-finality-provider</code>
command but you will be able to check in real time the status of the
finality provider.</p>
<p>For more information on statuses please refer to diagram in the core documentation
<a href="fp-core.md">fp-core</a>.</p>
<p>After successful registration, you may start the finality provider instance
by running:</p>
<pre><code class="language-shell">fpd start --eots-pk &#x3C;hex-string-of-eots-public-key>
</code></pre>
<p>If <code>--eots-pk</code> is not specified, the command will start the finality provider
if it is the only one stored in the database. If multiple finality providers
are in the database, specifying <code>--eots-pk</code> is required.</p>
<h3>6.3. Editing your finality provider</h3>
<p>If you need to edit your finality provider's information, you can use the
following command:</p>
<pre><code class="language-shell">fpd edit-finality-provider &#x3C;hex-string-of-eots-public-key> \
  --commission-rate &#x3C;commission-rate> \
  --home &#x3C;path-to-fpd-home-dir>
  # Add any other parameters you would like to modify
</code></pre>
<p>Parameters:</p>
<ul>
<li><code>&#x3C;hex-string-of-eots-public-key></code>: The EOTS public key of the finality provider</li>
<li><code>--commission-rate</code>: A required flag for the commission rate for the finality
provider</li>
<li><code>--home</code>: An optional flag for the path to your finality provider daemon home
directory</li>
</ul>
<p>Parameters you can edit:</p>
<ul>
<li><code>--moniker</code>: A human-readable name for your finality provider</li>
<li><code>--website</code>: Your finality provider's website</li>
<li><code>--security-contact</code>: Contact email for security issues</li>
<li><code>--details</code>: Additional description of your finality provider</li>
</ul>
<p>You can then use the following command to check if the finality provider has been
edited successfully:</p>
<pre><code class="language-shell">fpd finality-provider-info &#x3C;hex-string-of-eots-public-key>
</code></pre>
<h3>6.4. Jailing and Unjailing</h3>
<p>When jailed, the following happens to a finality provider:</p>
<ul>
<li>Their voting power becomes <code>0</code></li>
<li>Status is set to <code>JAILED</code></li>
<li>Delegator rewards stop</li>
</ul>
<p>To unjail a finality provider, you must complete the following steps:</p>
<ol>
<li>Fix the underlying issue that caused jailing (e.g., ensure your node is
properly synced and voting)</li>
<li>Wait for the jailing period to pass (defined by finality module parameters)</li>
<li>Send the unjail transaction to the Babylon chain using the following command:</li>
</ol>
<pre><code class="language-shell">fpd unjail-finality-provider &#x3C;eots-pk> --daemon-address &#x3C;rpc-address> --home &#x3C;path>
</code></pre>
<p>Parameters:</p>
<ul>
<li><code>&#x3C;eots-pk></code>: Your finality provider's EOTS public key in hex format</li>
<li><code>--daemon-address</code>: RPC server address of fpd (default: <code>127.0.0.1:12581</code>)</li>
<li><code>--home</code>: Path to your finality provider daemon home directory</li>
</ul>
<blockquote>
<p>⚠️ Before unjailing, ensure you've fixed the underlying issue that caused jailing</p>
</blockquote>
<p>If unjailing is successful, you may start running the finality provider by
<code>fpd start --eots-pk &#x3C;hex-string-of-eots-public-key></code>.</p>
<h3>6.5. Slashing and Anti-slashing</h3>
<p><strong>Slashing occurs</strong> when a finality provider <strong>double signs</strong>, meaning that the
finality provider signs conflicting blocks at the same height. This results in
the extraction of the finality provider's private key and their immediate
removal from the active set. For details about how the slashing works in the
BTC staking protocol, please refer to our <a href="https://docs.babylonlabs.io/papers/btc_staking_litepaper(EN).pdf">light paper</a>.</p>
<blockquote>
<p>⚠️ <strong>Critical</strong>: Slashing is irreversible and results in
permanent removal from the network.</p>
</blockquote>
<p>Apart from malicious behavior, honest finality providers face <a href="https://cubist.dev/blog/slashing-risks-you-need-to-think-about-when-restaking">slashing risks</a>
due to factors like hardware failures or software bugs.
Therefore, a proper slashing protection mechanism is required.
For details about how our built-in anti-slashing works, please refer to
our technical document <a href="../docs/slashing-protection.md">Slashing Protection</a>.</p>
<h3>6.6. Prometheus Metrics</h3>
<p>The finality provider exposes Prometheus metrics for monitoring your
finality provider. The metrics endpoint is configurable in <code>fpd.conf</code>:</p>
<h4>Core Metrics</h4>
<ol>
<li>
<p><strong>Status for Finality Providers</strong></p>
<ul>
<li><code>fp_status</code>: Current status of a finality provider</li>
<li><code>babylon_tip_height</code>: The current tip height of the Babylon network</li>
<li><code>last_polled_height</code>: The most recent block height checked by the poller</li>
</ul>
</li>
<li>
<p><strong>Key Operations</strong></p>
<ul>
<li><code>fp_seconds_since_last_vote</code>: Seconds since the last finality sig vote</li>
<li><code>fp_seconds_since_last_randomness</code>: Seconds since the last public
randomness commitment</li>
<li><code>fp_total_failed_votes</code>: The total number of failed votes</li>
<li><code>fp_total_failed_randomness</code>: The total number of failed
randomness commitments</li>
</ul>
</li>
</ol>
<p>Each metric with <code>fp_</code> prefix includes the finality provider's BTC public key
hex as a label.</p>
<blockquote>
<p>💡 <strong>Tip</strong>: Monitor these metrics to detect issues before they lead to jailing:</p>
<ul>
<li>Large gaps in <code>fp_seconds_since_last_vote</code></li>
<li>Increasing <code>fp_total_failed_votes</code></li>
</ul>
</blockquote>
<p>For a complete list of available metrics, see:</p>
<ul>
<li>Finality Provider metrics: <a href="../metrics/fp_collectors.go">fp_collectors.go</a></li>
<li>EOTS metrics: <a href="../metrics/eots_collectors.go">eots_collectors.go</a></li>
</ul>
<h3>6.7 Rewards</h3>
<p>Rewards are accumulated in a reward gauge, and a finality provider becomes
eligible for a rewards gauge when it meets certain conditions, such as
having an <code>ACTIVE</code> status, participating in voting, and obtaining
delegations. The distribution of rewards is based on the provider's
voting power portion relative to other voters.</p>
<h4>6.7.1 Querying Rewards</h4>
<p>To query rewards of a given stakeholder address, use the following command.</p>
<pre><code class="language-shell">fpd reward-gauges &#x3C;address>
</code></pre>
<p>Parameters:</p>
<ul>
<li><code>&#x3C;address></code>: The Babylon address of the stakeholder in bech32 string.</li>
</ul>
<h4>6.8 Recover local status of a finality provider</h4>
<p>To recover the local status of a finality provider, use the following command:</p>
<pre><code class="language-shell">fpd set-withdraw-addr &#x3C;new-address> --from &#x3C;registered-bbn-address>
--keyring-backend test --home &#x3C;home-dir> --fees &#x3C;fees>
</code></pre>
<p>Parameters:</p>
<ul>
<li><code>&#x3C;new-address></code>: The new address to withdraw rewards to.</li>
<li><code>--from</code>: The finality provider's registered Babylon address.</li>
<li><code>--keyring-backend</code>: The keyring backend to use.</li>
<li><code>--home</code>: The home directory for the finality provider.</li>
<li><code>--fees</code>: The fees to pay for the transaction, should be over <code>400ubbn</code>.
These fees are paid from the account specified in <code>--from</code>.</li>
</ul>
<p>This command should ask to
<code>confirm transaction before signing and broadcasting [y/N]:</code> and output the
transaction hash.</p>
<p>Once the address is set, rewards can be withdrawn by running the
following command:</p>
<pre><code class="language-shell">fpd withdraw-reward &#x3C;type> --from &#x3C;registered-bbn-address>
--keyring-backend test --home &#x3C;home-dir> --fees &#x3C;fees>
</code></pre>
<p>Parameters:</p>
<ul>
<li><code>&#x3C;type></code>: The type of reward to withdraw (one of <code>finality_provider</code>,
<code>btc_staker</code>)</li>
<li><code>--from</code>: The finality provider's registered Babylon address.</li>
<li><code>--keyring-backend</code>: The keyring backend to use.</li>
<li><code>--home</code>: The home directory for the finality provider.</li>
<li><code>--fees</code>: The fees to pay for the transaction, should be over <code>400ubbn</code>.
These fees are paid from the account specified in <code>--from</code>.</li>
</ul>
<p>Again, this command should ask to
<code>confirm transaction before signing and broadcasting [y/N]:</code> and output the
transaction hash.</p>
<p>This will withdraw <strong>ALL</strong> accumulated rewards to the address you set in the
<code>set-withdraw-addr</code> command if you set one. If no withdrawal address was set,
the rewards will be withdrawn to your finality provider address.</p>
<p>Congratulations! You have successfully set up and operated a finality provider.</p>
<h2>7. Recovery and Backup</h2>
<h3>7.1 Critical Assets</h3>
<p>The following assets <strong>must</strong> be backed up frequently to prevent loss of service or funds:</p>
<p>For EOTS Manager:</p>
<ul>
<li><strong>keyring-</strong>* directory: Contains your EOTS private keys used for signing. Loss of these keys means:
<ul>
<li>Unable to sign finality signatures</li>
<li>Unable to recover your finality provider identity</li>
<li>Permanent loss of your finality provider position</li>
</ul>
</li>
<li><strong>eotsd.db</strong>: Contains key mappings and metadata. While less critical, loss means:
<ul>
<li>Need to re-register key mappings</li>
<li>Temporary service interruption</li>
<li>Loss of anti-slashing protection</li>
</ul>
</li>
</ul>
<p>For Finality Provider:</p>
<ul>
<li><strong>keyring-</strong>* directory: Contains your Babylon account keys used for:
<ul>
<li>Submitting finality signatures to Babylon</li>
<li>Collecting rewards</li>
<li>Managing your finality provider</li>
<li>Loss means inability to operate until restored</li>
</ul>
</li>
<li><strong>finality-provider.db</strong>: Contains operational data including:
<ul>
<li>Public randomness proofs</li>
<li>State info of the finality provider</li>
<li>Loss of anti-slashing protection</li>
</ul>
</li>
</ul>
<h3>7.2 Backup Recommendations</h3>
<ol>
<li>
<p>Regular Backups:</p>
<ul>
<li>Daily backup of keyring directories</li>
<li>Weekly backup of full database files</li>
<li>Store backups in encrypted format</li>
<li>Keep multiple backup copies in separate locations</li>
</ul>
</li>
<li>
<p>Critical Times for Backup:</p>
<ul>
<li>After initial setup</li>
<li>Before any major updates</li>
<li>After key operations</li>
<li>After configuration changes</li>
</ul>
</li>
<li>
<p>Recovery Testing:</p>
<ul>
<li>Regularly test recovery procedures</li>
<li>Maintain documented recovery process</li>
<li>Practice key restoration in test environment</li>
</ul>
</li>
</ol>
<blockquote>
<p>🔒 <strong>Security Note</strong>: While database files can be recreated, loss of private
keys in the keyring directories is <strong>irrecoverable</strong> and will result in
permanent loss of your finality provider position and accumulated rewards.</p>
</blockquote>
<h3>7.3 Recover finality-provider db</h3>
<p>The <code>finality-provider.db</code> file contains both the finality provider's running
status and the public randomness merkle proof. Either information loss
compromised will lead to service halt, but they are recoverable.</p>
<h4>7.3.1 Recover local status of a finality provider</h4>
<p>The local status of a finality provider is defined as follows:</p>
<pre><code class="language-go">type StoredFinalityProvider struct {
	FPAddr          string
	BtcPk           *btcec.PublicKey
	Description     *stakingtypes.Description
	Commission      *sdkmath.LegacyDec
	ChainID         string
	LastVotedHeight uint64
	Status          proto.FinalityProviderStatus
}
</code></pre>
<p>It can be recovered by downloading the finality provider's info from the
Babylon chain. Specifically, this can be achieved by repeating the
<a href="#61-create-finality-provider">creation process</a>. The <code>create-finality-provider</code>
cmd will download the info of the finality provider locally if it is already
registered on Babylon.</p>
<h4>7.3.2 Recover public randomness proof</h4>
<p>Every finality vote must contain the public randomness proof to prove that the
randomness used in the signature is already committed on Babylon. Loss of
public randomness proof leads to direct failure of the vote submission.</p>
<p>To recover the public randomness proof, the following steps should be followed:</p>
<ol>
<li>Ensure the <code>fpd</code> is stopped.</li>
<li>Unjail your finality provider if needed.</li>
<li>Run the recovery command
<code>fpd recover-rand-proof [eots-pk-hex] --start-height [height-to-recover] --chain-id [chain-id]</code>
where <code>start-height</code> is the height from which you want to recover from. If
the <code>start-height</code> is not specified, the command will recover all the proofs
from the first commit on Babylon, which incurs longer time for recovery.
The <code>chain-id</code> must be specified exactly the same as the <code>chain-id</code> used when
creating the finality provider.</li>
<li>Restart the finality provider</li>
</ol>

  </article>
</body>
</html>
  